<HTML>
<HEAD>
<title>
Media Connnection package for S.410
</title>
</head>
<BODY LINK="#0000ff" VLINK="#800080">
<p>
Defines the MediaConnection interface which is used to control the 
connection of media streams between MediaService objects.
</p>
<H3>
Package Overview
</h3>
This package defines a intra-group media connection interface
for S.410 (<tt>javax.telephony.media</tt>) MediaServices.
<p>
Media Connections are used to connect media streams between
the MediaGroups of two MediaServices.
The connections are modeled as bi-directional
streams, but the data flow can be restricted to <tt>mute</tt> 
flow in either or both directions.
<p>
<h4> System Model for Media Connections </h4>
This diagram shows two MediaGroups (A and B).
Every MediaGroup has a <i>Primary Stream</i> (marked A1 and B1),
and one or more <i>Secondary Streams</i> (marked A2 and B2).
<p>
<A NAME="Figure1"><!--  --></A>
<P ALIGN="CENTER">
<IMG SRC="doc-files/Slide_4.gif" ALT="A Media Group has a Primary Stream,
that connects internally to the configured Resources">
<br><B>Figure 1</B>
</P>
<p>
Data coming <i>in</i> to the MediaGroup on the Primary Stream
can be heard by all Resources in the MediaGroup.
Data generated by any Resource in the MediaGroup
is sent <i>out</i> on the Primary Stream.
Secondary Streams are treated like Resources:
Secondary Streams listen to the Primary Stream,
and output from a Secondary Stream is sent out the Primary Stream.
<p>
The Primary Stream is connected <i>internally</i>
to the various processing Resources in a MediaGroup
(a Player and Recorder are shown)
by the <tt>MediaService.configure()</tt> method.
<p>
The Primary Stream is (typcially) connected <i>externally</i>
to a telephony/network device; which JTAPI calls a 
<a href="../../Terminal.html"><tt>Terminal</tt></a>. 
Terminals that can be connected as the Primary Stream of a
MediaGroup are marked as implementing 
<a href="../MediaTerminal.html"><tt>MediaTerminal</tt></a>
<p>
Note, that from the point of view of the telephony network, 
the Media Group is <i>inside</i> a Terminal. 
The Player and Recorder are like the tape player
and recorder in your home answering machine; when your answering
machine plays your greeting, the internal tape player is connected
to the telephony Terminal and plays <i>out</i> to the network.
<p>
<h4> Arbitration </h4>
Note that if more that one Resource or Secondary stream is 
<i>talking</i> to the Primary Stream, a decision must be made
about how to mix the competing sources.  That decision is part
of the magic configuration logic in the Media Group.
The decision of how to handle multiple talkers is called
the <i>arbitration scheme</i> for the Media Group.
<p>
The most common arbitration scheme is called the <i>Last Talker Algorithm</i>
or "LTA" for short. The LTA says simply: that source that started
talking "last" (that is, most recently) is the source that is
transmitted out the Primary Stream.  If/when that source stops
talking, the Primary Stream resumes transmitting the previous
talker.  Internally, a stack is maintained; if a source stops
it is removed from the stack, if a source starts it is pushed
on the top of the stack.  LTA is useful because predicatable 
effects can be implemented without additional DSP resources.
<p>
An alternative arbitration scheme is to <i>mix</i> the two or
more competing talkers (similar to the operation of a conference bridge).
<p>
<h4> Media Connection methods </h4>
The MediaConnection package allows the application
to control the external connections between MediaGroups.
Given two MediaGroups (A and B, in the diagram above), there
are three ways they can be connected:

<table border="1" cellpadding="3">

<tr><td>Topology:</td><td>Terminology:</td>
<td>Connection type</td><td>Symbol</td></tr>

<tr><td>A2 connected to B2</td><td> A and B <i>bridged</i> </td>
<td><tt>SecondaryToSecondary</tt></td><td><tt>v_Bridge</tt></td></tr>

<tr><td>A1 connected to B1</td><td> <i>loopback</i> between A and B </td>
<td><tt>PrimaryToPrimary</tt></td><td><tt>v_Loopback</tt></td></tr>

<tr><td>A1 connected to B2</td><td> A <i>joins</i> B </td>
<td><tt>PrimaryToSecondary</tt></td><td><tt>v_Join</tt></td></tr>

</table>

<p>
The <tt>connect()</tt> method creates any of the three types of 
connections as determined by the <tt>connectionType</tt> argument.
<p>
Methods <tt>bridge()</tt>, <tt>join()</tt>, <tt>loopback()</tt> are
wrappers around <tt>connect()</tt> that use the indicated connection
type.
<p>
The <tt>setDataFlow()</tt> method selectively enables or disables
data flow in either direction for the stream.  
<p>
When <tt>MediaGroup</tt> is <i>bridged</i> to <tt>MediaGroup</tt> B, 
the party connected to A1 (via the telephony network) will
hear the Player in A and/or the party connected to B1.
The party at A1 can be heard by the Recorder in A and
by the party at B1.  The Recorder in B cannot hear A1,
and the Player in B cannot be heard by A1.
<p>
When <tt>MediaGroup</tt> and <tt>MediaGroup</tt> B are connected
by a <i>loopback</i>, then there is <i>no</i> external network connection.
The Player in A can be heard by the Recorder in B.
<p>
When <tt>MediaGroup</tt> A <i>joins</i>  <tt>MediaGroup</tt> B, the effect is as
if the Resouces of A become Resources of B. That is, the Resources
of A listen to the Primary Stream of B, and compete to talk to the
Primary Stream of B. 
<p>
<P ALIGN="CENTER">
<A NAME="Figure2">
<IMG SRC="doc-files/Slide_5.gif" ALT="Shows a Primary-to-Primary Bridge">
<IMG SRC="doc-files/Slide_6.gif" ALT="Shows a Secondary-to-Secondary Loopback">
<IMG SRC="doc-files/Slide_7.gif" ALT="Shows a Primary-to-Secondary Bridge">
<br>
<B>Figure 2</B>
</A>
</p>
<p>
<b>Note:</b>The streaming connections for bridged or loopback topologies are 
symetrical.  <tt>A.bridge(B)</tt> has the same result as <tt>B.bridge(A)</tt>
and <tt>A.loopback(B)</tt> has the same result as <tt>B.loopback(A)</tt>.
Of course, the sense of <tt>DataFlow</tt> is reversed: <tt>v_Talk</tt>
and <tt>v_Listen</tt> refer to the <i>object</i> of the method, 
not to the <i>argument</i>.
<p>
<b>Note:</b> if a MediaGroup has 
a Primary Stream connected to an external network 
(that is, to a <tt>MediaTerminal</tt>),
then it is not possible to connect that Primary Stream to 
a MediaGroup using <tt>loopback()</tt> or <tt>join()</tt>.
The initial ConfigSpec of the MediaService when it is bound determines
if the Primary Stream is connected to a MediaTerminal or is 
available for the MediaConnection methods.

<h4>Synchronous and Asychronous APIs </h4>
The interface <a href="MediaConnection.html">
<tt>javax.telephony.media.connection.MediaConnection</tt></a> 
defines the basic synchronous methods: 
<ul><li>
<tt>connect(...)</tt>
</li><li>
<tt>join(...)</tt>
</li><li>
<tt>bridge(...)</tt>
</li><li>
<tt>loopback(...)</tt>
</li><li>
<tt>disconnect(...)</tt>
</li><li>
<tt>setDataFlow(...)</tt>
</li></ul>
The Event and Listener and Async interfaces are derived from
<tt>MediaConnection</tt> following the same patterns 
used for <tt>MediaService</tt> methods.
<p>
The API Symbol constants for the <tt>MediaConnection</tt> package are defined,
by convention, in <tt>MediaConnectionConstants</tt>; which name 
is rather lengthy. So the interface <a href="Cnx.html"><tt>Cnx</tt></a> 
is supplied to provide a shorter form.  For example, one can use
<tt>Cnx.v_Join</tt> instead of <tt>MediaConnectionConstants.v_Join</tt>. 
<p>
@since JTAPI-1.4
</body>
</html>
</page>
